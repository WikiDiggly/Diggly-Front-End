"use strict";!function(e){e.extend({debounce:function(e,t,r,i){3==arguments.length&&"boolean"!=typeof r&&(i=r,r=!1);var a;return function(){var o=arguments;i=i||this,r&&!a&&e.apply(i,o),clearTimeout(a),a=setTimeout(function(){!r&&e.apply(i,o),a=null},t)}},throttle:function(e,t,r){var i,a,o;return function(){a=arguments,o=!0,r=r||this,i||!function(){o?(e.apply(r,a),o=!1,i=setTimeout(arguments.callee,t)):i=null}()}}})}(jQuery),console.log("listen to events"),$("body").on("D3:Click",function(e,t){console.log("recieved d3 click"),console.log(e),console.log("This is the article_id clicked: "+t)}),function(){angular.module("digglyFeProto",["ngAnimate","d3","ngCookies","ngSanitize","restangular","ui.router","mm.foundation","ngCsv"])}(),function(){function e(e,t,r){var i={restrict:"E",templateUrl:"app/components/search/search.html",controller:function(){var i=function(i){e.getId(i).then(function(e){t.go("explore",{id:e.pageid})})["catch"](function(e){r.error("~~~~ Error: The id was not returned ~~~~")})};$("body").on("search",function(e){i(e.searchString)})},link:function(t,r,i){var a=200,o="",n=0,s=void 0,l="";$("body").on("keyup",".searchBar",$.debounce(function(r){var i=r.keyCode;if(37!==i&&38!==i&&39!==i&&40!==i&&13!==i&&(n+=1,a=n%2!==0?0:200,$(".results").removeClass("active"),o=$(".searchBar").val(),""!==o)){var s=o.replace(" ","+");e.getSearchSuggest(s).then(function(e){e=e.plain(e),t.topics=_.filter(e,function(e){return!_.isEmpty(e)}),$(".results").addClass("active")})["catch"](function(e){console.log("Error happened in AJAX Request!!")})}},a)),$("body").on("keydown",".searchBar",function(e){var t=e.keyCode;if(37===t||38===t||39===t||40===t){var r=$(".results li").length,i=$(".results li").index($(".selected"));40===t?0>i?($(".results li").eq(0).addClass("selected"),i=0,s=$(".results .selected")):($(".results li").eq(i).removeClass("selected"),$(".results li").eq((i+1)%r).addClass("selected"),i=(i+1)%r,s=$(".results .selected")):38===t&&(-1===i?($(".results li").eq(r-1).addClass("selected"),i=r-1,s=$(".results .selected")):($(".results li").eq(i).removeClass("selected"),1>i?($(".results li").eq(r-Math.abs(i-1)%r).addClass("selected"),i=r-Math.abs(i-1)%r):($(".results li").eq(i-1).addClass("selected"),i-=1),s=$(".results .selected")))}else if(13===t){l=$(".results .selected").text(),$(".searchBar").val(l),$(".results").removeClass("active");var a=$.Event("search");a.searchString=l,$("body").trigger(a)}}),$("body").on("click",".results li",function(e){l=$(this).text(),$(".searchBar").val(l),$(".results").removeClass("active");var t=$.Event("search");t.searchString=l,$("body").trigger(t)})}};return i}e.$inject=["SearchService","$state","$log"],angular.module("digglyFeProto").directive("searchDiggly",e)}(),function(){function e(e){var t=this.action={getSearchSuggest:function(t){return e.oneUrl("suggest","http://rack36.cs.drexel.edu/suggest").get({q:t})},getId:function(t){return e.oneUrl("pageid","http://rack36.cs.drexel.edu/getpageid").get({q:t})}};return{getSearchSuggest:t.getSearchSuggest,getId:t.getId}}e.$inject=["Restangular"],angular.module("digglyFeProto").service("SearchService",e)}(),function(){function e(e){var t={clearHistory:function(){var t=e.__history__.length;e.__history__=_.drop(e.__history__,t)},clearBookmarks:function(){var t=e.__bookmarks__.length;e.__bookmarks__=_.drop(e.__history__,t)},removeHistoryItem:function(t){_.remove(e.__history__,function(e){return e.article_id===t.article_id})},removeBookmarkItem:function(t){_.remove(e.__bookmarks__,function(e){return e.article_id===t.article_id})},addBookmark:function(t){var r=function(e){return e.article_id===t.article_id},i=e.__bookmarks__;0===i.length&&e.__bookmarks__.push(t),-1===_.findIndex(i,r)&&e.__bookmarks__.push(t)},getHistory:function(){return e.__history__},getBookmarks:function(){return e.__bookmarks__}};return{clearHistory:t.clearHistory,clearBookmarks:t.clearBookmarks,removeHistoryItem:t.removeHistoryItem,removeBookmarkItem:t.removeBookmarkItem,getHistory:t.getHistory,addBookmark:t.addBookmark,getBookmarks:t.getBookmarks}}e.$inject=["$window"],angular.module("digglyFeProto").factory("ExploreService",e)}(),function(){function e(e,t,r,i,a){var o=this.model={history:[],currentTopic:"",data:""};i.history=o.history;var n=this.action={updateHistory:function(){i.$apply(function(){o.history.unshift(o.currentTopic),o.history=_.uniq(o.history),a.__history__=o.history})},fetchTopic:function(t){e.getRelevantTopics(t).then(function(e){o.data=e.plain(e),o.currentTopic=_.omit(o.data,"linked_topics"),r.go("explore.visual",{id:t},{location:!0,notify:!1,reload:!1})})["finally"](function(){o.history.unshift(o.currentTopic),o.history=_.uniq(o.history),a.__history__=o.history})},addBookmark:function(e){t.addBookmark(e)},onClick:function(e){n.updateHistory(),n.fetchTopic(e),$("body").trigger("D3:Click",e)},init:function(){r.params.id&&n.fetchTopic(r.params.id),o.history=t.getHistory()||[],a.__bookmarks__=t.getBookmarks()||[]}};n.init()}e.$inject=["DigglyService","ExploreService","$state","$scope","$window"],angular.module("digglyFeProto").controller("VisualController",e)}(),function(){function e(e){var t=this.model={history:[]},r=this.action={removeItem:function(t){e.removeHistoryItem(t)},clearHistory:function(){e.clearHistory(),t.history.length=0},init:function(){t.history=e.getHistory()||""}};r.init()}e.$inject=["ExploreService"],angular.module("digglyFeProto").controller("HistoryController",e)}(),function(){function e(e,t,r){var i=this.model={bookmarks:[],exportType:"",extensions:[{label:"Text File (.txt)",type:"txt"},{label:"Spreadsheet (.xls)",type:"xls"}],downloadUrl:""},a=this.action={removeItem:function(t){e.removeBookmarkItem(t)},clearBookmark:function(){e.clearBookmarks(),i.bookmark.length=0},"export":function(){switch(i.exportType){case"xls":i.downloadUrl=a.exportXls();break;default:case"text":var e=JSON.stringify(t.__bookmarks__);i.downloadUrl=a.exportText(e)}},exportText:function(e){var r=new Blob([e],{type:"text/plain"});null!==i&&t.URL.revokeObjectURL(i);var i=t.URL.createObjectURL(r);return i},exportXls:function(){return"not working yet"},init:function(){i.bookmarks=e.getBookmarks()||"",i.downloadUrl=a.exportText("text")}};a.init()}e.$inject=["ExploreService","$window","$scope"],angular.module("digglyFeProto").controller("BookmarkController",e)}(),function(){function e(){function e(e){var t=this;t.relativeDate=e(t.creationDate).fromNow()}e.$inject=["moment"];var t={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("digglyFeProto").directive("acmeNavbar",e)}(),function(){function e(e,t){var r={restrict:"EA",scope:{data:"=",onClick:"&"},link:function(r,i,n){var s=r.model={d3Data:{nodes:"",edges:""}};e.d3().then(function(e){var n=e.select(i[0]).append("svg").style("width","100%").style("height","100%");t.onresize=function(){r.$apply()},r.$watch(function(){return angular.element(t)[0].innerWidth},function(){r.render(r.data)}),r.$watch("data",function(e,t){r.render(e)},!0),r.render=function(t){if(n.selectAll("*").remove(),t){s.d3Data.nodes=a(t),s.d3Data.edges=o(t.linked_topics.length);var i=e.scale.category10(),l=e.layout.force().nodes(s.d3Data.nodes).links(s.d3Data.edges).size([500,500]).linkDistance(130).charge([-500]).theta(.1).gravity(.05).on("tick",v).start(),c=n.selectAll("line").data(s.d3Data.edges).enter().append("line").attr("id",function(e,t){return"edge"+t}).attr("marker-end","url(#marker_circle)").style("stroke","#ccc").style("pointer-events","none"),d=n.selectAll("circle").data(s.d3Data.nodes).enter().append("circle").attr({r:function(e,t){return 40*e.score},"class":function(e,t){return"node-"+t}}).style("fill",function(e,t){return i(t)}).style("cursor",function(e,t){return 0===t?"move":"pointer"}).call(l.drag).on("click",function(e,t){if(0!==t){var i=e.target_id;r.onClick({item:i})}}),u=n.selectAll(".nodelabel").data(s.d3Data.nodes).enter().append("text").attr({x:function(e){return e.x},y:function(e){return e.y},"class":function(e,t){return"label-"+t},stroke:"black"}).text(function(e){return e.title}),m=n.selectAll(".edgepath").data(s.d3Data.edges).enter().append("path").attr({d:function(e){return"M "+e.source.x+" "+e.source.y+" L "+e.target.x+" "+e.target.y},"class":"edgepath","fill-opacity":0,"stroke-opacity":0,fill:"blue",stroke:"red",id:function(e,t){return"edgePath-"+t}}).style("pointer-events","none"),p=n.selectAll(".edgelabel").data(s.d3Data.edges).enter().append("text").style("pointer-events","none").attr({"class":"edgelabel",id:function(e,t){return"edgelabel-"+t},dx:80,dy:0,"font-size":10,fill:"#aaa"});p.append("textPath").attr("xlink:href",function(e,t){return"#edgepath"+t}).style("pointer-events","none"),n.append("defs").append("marker").attr({id:"arrowhead",viewBox:"-0 -5 10 10",refX:25,refY:0,orient:"auto",markerWidth:10,markerHeight:10,xoverflow:"visible"}).append("svg:path").attr("d","M 0,-5 L 10 ,0 L 0,5").attr("fill","#ccc").attr("stroke","#ccc");var v=function(){c.attr({x1:function(e){return e.source.x},y1:function(e){return e.source.y},x2:function(e){return e.target.x},y2:function(e){return e.target.y}}),d.attr({cx:function(e){return e.x},cy:function(e){return e.y}}),u.attr("x",function(e){return e.x}).attr("y",function(e){return e.y}),m.attr("d",function(e){var t="M "+e.source.x+" "+e.source.y+" L "+e.target.x+" "+e.target.y;return t})};l.on("tick",v)}}})}},i=function(e){var t={};return t=_.omit(e,["linked_topics"]),t.title=t.article_title,t.score=1,[t]},a=function(e){var t=_.union(i(e),e.linked_topics);return t},o=function(e){var t=_.times(e,function(e){return{source:e+1,target:0}});return t};return r}e.$inject=["d3Service","$window"],angular.module("digglyFeProto").directive("digglyVisual",e)}(),function(){angular.module("d3",[])}(),function(){function e(e,t,r){function i(){r.$apply(function(){a.resolve(window.d3)})}var a=t.defer(),o=e[0].createElement("script");o.type="text/javascript",o.async=!0,o.src="http://d3js.org/d3.v3.min.js",o.onreadystatechange=function(){"complete"===this.readyState&&i()},o.onload=i;var n=e[0].getElementsByTagName("body")[0];return n.appendChild(o),{d3:function(){return a.promise}}}e.$inject=["$document","$q","$rootScope"],angular.module("d3").factory("d3Service",e)}(),function(){function e(e){var t="http://localhost:8000/diggly/";e.setBaseUrl(t);var r=e.all("topics"),i=this.action={getAllTopics:function(){return r.getList()},getTopic:function(t){return e.one("topics",t).get()},getRelevantTopics:function(e){return r.one("explore",e).get()}};return{getAllTopics:i.getAllTopics,getTopic:i.getTopic,getRelevantTopics:i.getRelevantTopics}}e.$inject=["Restangular"],angular.module("digglyFeProto").service("DigglyService",e)}(),function(){function e(e){e.debug("Diggly is up and running, at your service!")}function t(e,t){e.$on("$stateChangeStart",function(e,r,i){r.redirectTo&&(e.preventDefault(),t.go(r.redirectTo,i))})}e.$inject=["$log"],t.$inject=["$rootScope","$state"],angular.module("digglyFeProto").run(e).run(t)}(),function(){function e(e,t,r){e.state("home",{url:"/",templateUrl:"app/home/views/home.html"}).state("explore",{url:"/explore/:id",templateUrl:"app/explore/views/layout.html",redirectTo:"explore.visual"}).state("explore.visual",{url:"/visual",parent:"explore",templateUrl:"app/explore/views/visual.html",controller:"VisualController",controllerAs:"visual"}).state("explore.history",{parent:"explore",url:"/history",templateUrl:"app/explore/views/history.html",controller:"HistoryController",controllerAs:"history"}).state("explore.bookmark",{parent:"explore",url:"/bookmarks",templateUrl:"app/explore/views/bookmarks.html",controller:"BookmarkController",controllerAs:"bookmarks"}),t.otherwise("/"),r.html5Mode(!0)}e.$inject=["$stateProvider","$urlRouterProvider","$locationProvider"],angular.module("digglyFeProto").config(e)}(),function(){angular.module("digglyFeProto").constant("malarkey",malarkey).constant("toastr",toastr).constant("moment",moment)}(),function(){function e(e,t,r){r.aHrefSanitizationWhitelist(/^\s*(https?|blob):/),e.debugEnabled(!0),t.options.timeOut=3e3,t.options.positionClass="toast-top-right",t.options.preventDuplicates=!0,t.options.progressBar=!0}e.$inject=["$logProvider","toastr","$compileProvider"],angular.module("digglyFeProto").config(e)}(),angular.module("digglyFeProto").run(["$templateCache",function(e){e.put("app/components/search/search.html",'<div class="search-container center"><span class="fa fa-search"></span> <input type="text" placeholder="Search" class="searchBar"><ul class="results"><li ng-repeat="topic in topics">{{topic.title}}</li></ul></div>'),e.put("app/components/navbar/navbar.html",'<nav class="top-bar row"><ul class="title-area"><li class="name"><h1><a ui-sref="home">Diggly</a></h1></li></ul><section class="top-bar-section"><ul class="right"><explore-navigation></explore-navigation></ul></section></nav>'),e.put("app/explore/views/bookmarks.html",'<section class="bookmarks"><article class="medium-8 small-12 columns card bookmarks__card"><div class="heading"><h2>Saved Bookmarks</h2><div class="buttons"><a ng-click="bookmarks.action.clearBookmarks()"><i class="material-icons">delete_sweep</i></a></div></div><ul><li ng-repeat="bookmark in bookmarks.model.bookmarks"><h4>{{ bookmark.article_title}}</h4><p>{{ bookmark.summary | limitTo: 1000 }} ...</p><div class="option-wrap"><a href="{{ bookmark.wiki_link }}" target="_blank"><i class="material-icons">launch</i>Go to Wikipedia</a> <a ng-click="bookmarks.action.removeItem(bookmark)"><i class="material-icons">remove_circle_outline</i>Remove Item</a></div></li></ul></article><div class="medium-4 small-12 columns export"><article ng-cloak="" class="small-12 columns card"><div class="export__card"><h3>Export</h3><div class="export__summary"><p>Export to an external file to save on your local computer.</p></div><div class="export__selection"><select name="exportSelection" ng-model="bookmarks.model.exportType" ng-change="bookmarks.action.export()" ng-options="extension.type as extension.label for extension in bookmarks.model.extensions"><option value="">Choose File Type</option></select></div><div class="export__btns"><a ng-href="{{ bookmarks.model.downloadUrl }}" class="export__btn" download="">Export</a></div></div></article></div></section>'),e.put("app/explore/views/history.html",'<section class="history"><article class="card history__card"><div class="heading"><h2>Previously Viewed</h2><div class="buttons"><a ng-click="history.action.clearHistory()"><i class="material-icons">delete_sweep</i></a></div></div><ul><li ng-repeat="topic in history.model.history"><h4>{{ topic.article_title}}</h4><p>{{ topic.summary | limitTo: 300 }} ...</p><div class="option-wrap"><a href="{{ topic.wiki_link }}" target="_blank"><i class="material-icons">launch</i>Go to Wikipedia</a> <a ng-click="history.action.removeItem(topic)"><i class="material-icons">remove_circle_outline</i>Remove Item</a></div></li></ul></article></section>'),e.put("app/explore/views/layout.html",'<header class="app-header"><div class="row"><h1>diggly</h1></div></header><div class="navigation"><nav class="top-bar row"><div class="top-bar-section"><ul class="left"><li><a ui-sref="home">Home</a></li><li ui-sref-active="active"><a ui-sref="explore">Explore</a></li></ul></div><div class="right"><search-diggly></search-diggly></div></nav></div><main class="explore"><div class="row"><nav class="top-bar"><div class="top-bar-section"><div class="left"><h2>Explore</h2></div><ul class="right"><li ui-sref-active="active"><a ui-sref="explore.visual({ history: history })">Visual</a></li><li ui-sref-active="active"><a ui-sref="explore.history({ history: history })">History</a></li><li ui-sref-active="active"><a ui-sref="explore.bookmark">Bookmarks</a></li></ul></div></nav><div class="small-12 columns"><div class="row"><div ui-view=""></div></div></div></div></main>'),e.put("app/explore/views/visual.html",'<section class="visual"><div class="medium-8 small-12 columns"><section ng-cloak="" class="visualizer card"><diggly-visual class="visualizer-container" data="visual.model.data" on-click="visual.action.onClick(item)"></diggly-visual></section></div><div class="medium-4 small-12 columns quick-info"><article ng-cloak="" class="small-12 columns card"><div class="current-card"><h3>{{ visual.model.currentTopic.article_title }}</h3><div class="current-card__summary"><p>{{ visual.model.currentTopic.summary }}</p></div><div class="current-card__btns"><a ng-href="{{ visual.model.currentTopic.wiki_link }}" target="_blank"><i class="material-icons">launch</i></a> <a class="add-bookmark" ng-click="visual.action.addBookmark(visual.model.currentTopic)"><i class="material-icons">bookmark_border</i></a></div></div></article><article ng-cloak="" class="small-12 columns card"><div class="history-card"><h3>History</h3><div class="history-card__list"><ul><li ng-repeat="topic in visual.model.history"><a ui-sref="explore.visual({ id: topic.article_id })">{{ topic.article_title}}</a><div class="buttons"><a href="{{ topic.wiki_link }}" target="_blank"><i class="material-icons">launch</i></a> <a ng-click="visual.action.addBookmark(topic)"><i class="material-icons">bookmark_border</i></a></div></li></ul></div></div></article></div></section>'),e.put("app/home/views/home.html",'<main class="home"><header><div class="row"><h1 ui-sref="home">diggly</h1><div class="search-wrap"><search-diggly></search-diggly></div></div></header><section class="recent"><div class="row"><h3>Recently Discovered</h3><article class="medium-4 small-12 columns"><div class="card"><h4>Ramen</h4><p>Ramen (/ˈrɑːmən/) (ラーメン, rāmen, IPA: [ɽäꜜːmeɴ]) is a Japanese noodle soup dish. It consists of Chinese-style wheat noodles served in a meat- or (occasionally)...</p><div class="card-btn__container"><a ui-sref="explore({id:37969})"><i class="material-icons">arrow_forward</i></a></div></div></article><article class="medium-4 small-12 columns"><div class="card"><h4>Crab Rangoon</h4><p>Crab Rangoon, sometimes called crab puffs, crab rangoon puffs, or cheese wontons, are deep-fried dumpling appetizers served in American Chinese and...</p><div class="card-btn__container"><a ui-sref="explore({id:47775352})"><i class="material-icons">arrow_forward</i></a></div></div></article><article class="medium-4 small-12 columns"><div class="card"><h4>Spring roll</h4><p>Spring rolls are a large variety of filled, rolled appetizers or dim sum found in East Asian and Southeast Asian cuisine. The name is a literal translation of the ...</p><div class="card-btn__container"><a ui-sref="explore({id:1330232})"><i class="material-icons">arrow_forward</i></a></div></div></article></div></section><section class="interest"><div class="row"><article class="medium-4 small-12 columns"><h3>Trending Now</h3><div class="card"><h4>Nancy Reagan</h4><p>Nancy Davis Reagan (born Anne Frances Robbins; July 6, 1921 – March 6, 2016) was an American actress and the wife of the 40th President of the United States...</p><div class="card-btn__container"><a ui-sref="explore({id:21181})"><i class="material-icons">arrow_forward</i></a></div></div></article><article class="medium-4 small-12 columns"><h3>Most Popular</h3><div class="card"><h4>Taylor Swift</h4><p>Taylor Alison Swift (born December 13, 1989) is an American singer-songwriter. Raised in Wyomissing, Pennsylvania, she moved to Nashville, ...</p><div class="card-btn__container"><a ui-sref="explore({id:5422144})"><i class="material-icons">arrow_forward</i></a></div></div></article><article class="medium-4 small-12 columns"><h3>Something New</h3><div class="card"><h4>Britney Spears</h4><p>Britney Jean Spears (born December 2, 1981) is an American singer and actress...</p><div class="card-btn__container"><a ui-sref="explore({id:3382})"><i class="material-icons">arrow_forward</i></a></div></div></article></div></section></main>')}]);